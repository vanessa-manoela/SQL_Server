criando tabela de log e trigger para preencher a tabela

CREATE TABLE TBL_FATURAMENTO (
DATA_VENDA DATE NULL,
TOTAL_VENDA FLOAT)


CREATE TRIGGER TG_ITENS_VENDIDOS
ON [ITENS VENDIDOS]

AFTER INSERT, UPDATE, DELETE --a trigger será executada após um comando de insert, delete ou update
AS
BEGIN

DELETE FROM TBL_FATURAMENTO;

INSERT INTO TBL_FATURAMENTO (
DATA_VENDA, TOTAL_VENDA)
SELECT A.DATA AS DATA_VENDA, SUM(B.QUANTIDADE = B.[PREÇO]) AS TOTAL_VENDA
FROM NOTAS A INNER JOIN [ITENS VENDIDOS] B
ON A.NUMERO = B.NUMERO
GROUP BY A.DATA;

END;




SELECT CPF, IDADE, DATA_NASCIMENTO,
DATEDIFF (YEAR, DATA_NASCIMENTO, GETDATE()) --calcula a idade em anos, baseado na tada atual
FROM CLIENTES




CREATE TRIGGER TG_CLIENTE_IDADE
ON CLIENTES

AFTER INSERT, UPDATE, DELETE
AS
BEGIN

UPDATE TABELA_CLIENTES
SET IDADE = DATEDIFF (YEAR, DATA_NASCIMENTO, GETDATE());

END;



